<% content_for :title, "Posts" %>

<div class="max-w-3xl mx-auto space-y-6">
  <!-- Head with title and New Post button -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">Posts</h1>

    <% if safe_user_signed_in? %>
      <%= link_to "New Post", new_post_path,
            data: { turbo_frame: "new_post" },
            class: "btn-primary" %>
    <% end %>
  </div>

  <!-- New Post frame -->
  <%= turbo_frame_tag "new_post" %>

  <div id="posts_list" class="space-y-4">
    <%= turbo_stream_from "posts" %>

    <% Rails.logger.info ">>> DEBUG: user_signed_in? = #{safe_user_signed_in?.inspect}" %>

    <% if safe_user_signed_in? %>
      <%= turbo_stream_from "posts_logged_in" %>
    <% end %>

    <% @posts.each do |post| %>
      <% if safe_user_signed_in? %>
        <%= render "posts/post_container", post: post %>
      <% else %>
        <%= render "posts/post_broadcast", post: post %>
      <% end %>
    <% end %>
  </div>
</div>
